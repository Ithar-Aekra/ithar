<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>تصویر و ویدیو متصل با اسکرول و زوم</title>
<style>
  html, body {
    margin: 0; padding: 0; height: 100%; overflow: hidden;
    direction: rtl;
    background: #000;
  }
  #container {
    position: relative;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    touch-action: none;
    cursor: grab;
  }
  #image {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    user-select: none;
    pointer-events: none;
  }
  #video {
    position: absolute;
    top: 50%;
    left: 50%;
    transform-origin: top left;
    max-width: 100%;
    max-height: 100%;
    pointer-events: auto;
  }
</style>
</head>
<body>

<div id="container">
  <img id="image" src="image2.jpg" alt="background" />
  <video id="video" src="video1.mp4" muted loop autoplay></video>
</div>

<script>
  (function() {
    const container = document.getElementById('container');
    const video = document.getElementById('video');

    // مقادیر اولیه
    let scale = 1;
    let minScale = 1;
    let maxScale = 3;

    // موقعیت (جابجایی)
    let posX = 0;
    let posY = 0;

    // محدودیت جابجایی - براساس اندازه تصویر و اسکیل
    function clampPosition(x, y) {
      const containerRect = container.getBoundingClientRect();
      const videoWidth = video.videoWidth || video.clientWidth;
      const videoHeight = video.videoHeight || video.clientHeight;

      const scaledWidth = containerRect.width * scale;
      const scaledHeight = containerRect.height * scale;

      // محدود کردن جابجایی به محدوده تصویر (مانند پوشش تمام صفحه)
      const maxX = 0;
      const maxY = 0;
      const minX = containerRect.width - scaledWidth;
      const minY = containerRect.height - scaledHeight;

      x = Math.min(maxX, Math.max(minX, x));
      y = Math.min(maxY, Math.max(minY, y));
      return { x, y };
    }

    // به‌روزرسانی موقعیت و اندازه ویدیو
    function update() {
      video.style.transform = `translate(${posX}px, ${posY}px) scale(${scale}) translate(-50%, -50%)`;
    }

    // کنترل اسکرول برای زوم
    container.addEventListener('wheel', (e) => {
      e.preventDefault();

      const delta = -e.deltaY * 0.001; // جهت زوم
      let newScale = scale + delta;

      // محدود کردن زوم
      newScale = Math.min(maxScale, Math.max(minScale, newScale));

      // برای زوم حول موقعیت موس
      const rect = container.getBoundingClientRect();
      const mouseX = e.clientX - rect.left;
      const mouseY = e.clientY - rect.top;

      // نسبت موس به تصویر
      const dx = (mouseX - posX);
      const dy = (mouseY - posY);

      // تغییر موقعیت برای حفظ نقطه زیر موس ثابت
      posX -= dx * (newScale / scale - 1);
      posY -= dy * (newScale / scale - 1);

      scale = newScale;

      // محدود کردن جابجایی
      const clamped = clampPosition(posX, posY);
      posX = clamped.x;
      posY = clamped.y;

      update();
    }, { passive: false });

    // درگ برای جابجایی موقعیت (اسکرول با ماوس)
    let isDragging = false;
    let dragStartX, dragStartY;
    let startPosX, startPosY;

    container.addEventListener('mousedown', (e) => {
      e.preventDefault();
      isDragging = true;
      dragStartX = e.clientX;
      dragStartY = e.clientY;
      startPosX = posX;
      startPosY = posY;
      container.style.cursor = 'grabbing';
    });

    window.addEventListener('mouseup', () => {
      isDragging = false;
      container.style.cursor = 'grab';
    });

    window.addEventListener('mousemove', (e) => {
      if (!isDragging) return;

      e.preventDefault();
      const dx = e.clientX - dragStartX;
      const dy = e.clientY - dragStartY;

      posX = startPosX + dx;
      posY = startPosY + dy;

      // محدود کردن جابجایی
      const clamped = clampPosition(posX, posY);
      posX = clamped.x;
      posY = clamped.y;

      update();
    });

    // تنظیم اندازه اولیه ویدیو پس از لود
    video.addEventListener('loadedmetadata', () => {
      // اندازه ویدیو را متناسب با container قرار می‌دهیم
      video.style.width = '50vw';
      video.style.height = 'auto';
      update();
    });

    // اندازه ویدیو را متناسب با اندازه پنجره تنظیم کنیم هنگام تغییر سایز پنجره
    window.addEventListener('resize', () => {
      update();
    });

    // حالت اولیه
    update();

  })();
</script>

</body>
</html>
